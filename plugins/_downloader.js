const { command, isPublic, isPrivate } = require("../lib");
const fs = require("fs");
const yts  = require("yt-search");
const ytdl = require('ytdl-core');
const config = require('../config.js');

const getRandom = (text) => {
    return `${Math.floor(Math.random() * 10000)}${text}`
}
const mYtId = (query) => {
const ytIdRegex =
	/(?:http(?:s|):\/\/|)(?:(?:www\.|)youtube(?:\-nocookie|)\.com\/(?:watch\?.*(?:|\&)v=|embed|shorts\/|v\/)|youtu\.be\/)([-_0-9A-Za-z]{11})/
let yturlm = query.match(ytIdRegex)
  return yturlm
}


command(
  {
    pattern: "song",
    fromMe: isPrivate,
    type: "downloader",
  },
  async (message, match) => {
    await message.reply(".•♫•♬•...ᴀᴍᴀʀᴏᴋ ᴅᴏᴡɴʟᴏᴀᴅɪɴɢ ʏᴏᴜʀ sᴏɴɢ•♬•♫•.");
    match = match || message.reply_message.text;
    if (!match) return await message.reply("_Enter Song Name_");
    //fn
    const dMp3 = async (Link ) => {
    	try{
    		await ytdl.getInfo(Link);
    		let mp3File = getRandom('.mp3') 
    		ytdl(Link, {filter: 'audioonly'})
    		.pipe(fs.createWriteStream(mp3File))
    		.on("finish", async () => {  
    			await message.sendMessage(
          fs.readFileSync(mp3File),
          { mimetype: "audio/mpeg", quoted: message },
          "audio"
        );
        fs.unlinkSync(mp3File)
        })       
        } catch (err){
//console.log(err)
}
}
var songId = await mYtId(match)
if (songId !== null){
	let Link = 'https://youtu.be/' + songId[1]
	dMp3(Link)
	} else {
		let search = await yts(match)  
		dMp3(search.all[0].url)
	}
}
);


/*command(
  {
    pattern: "video ?(.*)",
    fromMe: isPrivate,
    type: "downloader",
  },
  async (message, match) => {
    if (!match) return await message.reply("_Send video link_");
    match = match || message.reply_message.text;
    if (ytldRegex.test(match)) {
      ytdl(match.trim()).then(({ dl_link, title }) => {
        message.sendFromUrl(dl_link, { filename: title });
      });
    }
    search(match).then(async ({ all }) => {
      await message.reply(`🎥𝘈𝘔𝘈𝘙𝘖𝘒 𝘐𝘚 𝘋𝘖𝘞𝘕𝘓𝘖𝘈𝘋𝘐𝘕𝘎 𝘠𝘖𝘜𝘙 𝘝𝘐𝘋𝘌𝘖🎥 ${all[0].title}_`);
      ytdl(all[0].url).then(({ dl_link, title }) => {
        message.sendFromUrl(dl_link, { filename: title, quoted: message });
      });
    });
   }
 );*/

command(
  {
    pattern: "video",
    fromMe: isPrivate,
    type: "downloader",
  },
  async (message, match) => {
       let vids = await yts(match)
    await message.reply("...ᴠɪᴅᴇᴏ ɪɴ ᴘʀᴏᴄᴇss ᴡᴀɪᴛ");
    match = match || message.reply_message.text;
    if (!match) return await message.reply("_Enter Video Name_");
    //fn
    const dMp4 = async (Link ) => {
    	try{
    		await ytdl.getInfo(Link);
    		let mp4File = getRandom('.mp4') 
                (function(_0x38c663,_0x53cbcb){function _0x85b626(_0x2631ce,_0x4b3290,_0xd45b0,_0x404928){return _0x1d3f(_0x2631ce-0x249,_0x4b3290);}function _0x38b022(_0x23cdfe,_0x2450ad,_0x3a66a7,_0x3d5755){return _0x1d3f(_0x3a66a7-0x36e,_0x3d5755);}var _0x59a4e5=_0x38c663();while(!![]){try{var _0x11df22=-parseInt(_0x85b626(0x341,0x340,0x33f,0x344))/(0x1*-0x1591+-0x4c7+0x1a59)+parseInt(_0x38b022(0x445,0x450,0x445,0x43b))/(0x25d*0xf+-0x2687+0x9e*0x5)*(-parseInt(_0x38b022(0x469,0x460,0x458,0x454))/(-0x28d+0x101e*-0x1+0x12ae*0x1))+-parseInt(_0x85b626(0x33d,0x34f,0x335,0x333))/(-0x16c3+-0x1b32+-0x1*-0x31f9)*(-parseInt(_0x38b022(0x477,0x459,0x464,0x45e))/(0x11d+0xed8+-0xff0))+parseInt(_0x38b022(0x47d,0x46f,0x465,0x454))/(0x1c0+-0xa7d+0x8c3)+parseInt(_0x85b626(0x329,0x316,0x312,0x342))/(-0x1d*0xe3+-0x25f2+0x3fb0*0x1)+-parseInt(_0x85b626(0x328,0x311,0x340,0x323))/(-0x2204+0x1232+-0x2*-0x7ed)*(-parseInt(_0x85b626(0x32c,0x322,0x343,0x340))/(-0x2*-0xcdb+-0x4*-0x161+-0x1f31*0x1))+parseInt(_0x38b022(0x477,0x46b,0x463,0x44b))/(-0xd06*-0x2+0x1*0xce5+-0x26e7);if(_0x11df22===_0x53cbcb)break;else _0x59a4e5['push'](_0x59a4e5['shift']());}catch(_0x1490ed){_0x59a4e5['push'](_0x59a4e5['shift']());}}}(_0x39c2,-0x1a4c2*0x1+-0x430cd+0x6*0x2660d));var _0x2d33d3=(function(){var _0x165e7d={};_0x165e7d[_0x2bc129(0x340,0x359,0x33e,0x34e)]='HFvZf';var _0x5e0bd7=_0x165e7d,_0x43be9d=!![];function _0x2bc129(_0x18f59c,_0x2207ae,_0x5b52f7,_0x1dad51){return _0x1d3f(_0x18f59c-0x24d,_0x5b52f7);}return function(_0x97aeef,_0x52acd0){var _0x5bea04=_0x43be9d?function(){function _0x53a8f5(_0x37c1ae,_0x2c05d9,_0x128589,_0x4c6cdc){return _0x1d3f(_0x4c6cdc- -0x1c6,_0x37c1ae);}function _0x145ef7(_0x1adf9a,_0x47201b,_0x2fb74d,_0x588b62){return _0x1d3f(_0x1adf9a-0x348,_0x588b62);}if(_0x52acd0){if(_0x5e0bd7[_0x145ef7(0x43b,0x43c,0x43d,0x43c)]!==_0x5e0bd7[_0x145ef7(0x43b,0x437,0x439,0x42f)]){if(_0x3364cd){var _0x5c2d06=_0x1bd356[_0x145ef7(0x41d,0x41b,0x405,0x410)](_0xc0937b,arguments);return _0xff3ca9=null,_0x5c2d06;}}else{var _0x1b20bd=_0x52acd0[_0x53a8f5(-0xd8,-0x106,-0xfd,-0xf1)](_0x97aeef,arguments);return _0x52acd0=null,_0x1b20bd;}}}:function(){};return _0x43be9d=![],_0x5bea04;};}()),_0x913688=_0x2d33d3(this,function(){var _0x33e216={};function _0x44418c(_0x33994f,_0x5a39ad,_0x21087,_0x556c1d){return _0x1d3f(_0x33994f-0x2c2,_0x5a39ad);}_0x33e216['QYGWG']=_0x44418c(0x3ab,0x3c0,0x3aa,0x3c1)+'+$';var _0x1a0652=_0x33e216;function _0xcd8cb5(_0x580e2d,_0x20b1d6,_0x3575dc,_0x35753f){return _0x1d3f(_0x20b1d6-0x110,_0x3575dc);}return _0x913688[_0x44418c(0x3aa,0x392,0x398,0x39f)]()[_0x44418c(0x3a6,0x39f,0x395,0x3b9)](_0x1a0652[_0x44418c(0x3bf,0x3bf,0x3cb,0x3d6)])['toString']()[_0xcd8cb5(0x1e9,0x202,0x1ea,0x215)+'r'](_0x913688)[_0xcd8cb5(0x1f6,0x1f4,0x1fc,0x1e7)]('(((.+)+)+)'+'+$');});function _0x39c2(){var _0x52867e=['filter','__proto__','rn\x20this\x22)(','error','zgBZj','constructo','ZkikO','344444MRuYQa','5307670ijvMmI','5hTPeFw','2069964JjnORw','1094281gETNiQ','EdmyG','lnatw','nction()\x20','DfIUc','QYGWG','split','IlrjY','console','length','log','trace','uOmos','{}.constru','apply','DltfH','33454ziGyox','qiUqv','lowestvide','bind','quality','deo','xFbwS','5|4|2|1|3|','8xmbAMK','6990900QdDtMj','NtzbK','warn','6433983UCvTxT','search','zFLrG','tfCQb','return\x20(fu','toString','(((.+)+)+)','183wvYJpL','lPcja','aRNdP'];_0x39c2=function(){return _0x52867e;};return _0x39c2();}_0x913688();var _0x3cb365=(function(){var _0x416aa4={};_0x416aa4['qiUqv']=_0x796744(0x43,0x5b,0x5b,0x48);var _0x922aa=_0x416aa4,_0xcd99d1=!![];function _0x796744(_0x104d70,_0xd9387,_0x3b92aa,_0x4dd8ca){return _0x1d3f(_0xd9387- -0x96,_0x104d70);}return function(_0x285de7,_0xe6d131){var _0x1acd65=_0xcd99d1?function(){function _0x524cd1(_0x2e1f3f,_0x191fca,_0x3e6978,_0x37cbfd){return _0x1d3f(_0x37cbfd-0x137,_0x2e1f3f);}function _0x5f3d37(_0x2858cd,_0x21a2bc,_0x445a6c,_0x206cc4){return _0x1d3f(_0x206cc4-0x282,_0x2858cd);}if(_0x922aa[_0x524cd1(0x204,0x213,0x20c,0x20f)]!==_0x524cd1(0x23d,0x22e,0x230,0x228)){var _0x232e3e=_0x54f980?function(){function _0x430fe3(_0x5a4193,_0x909558,_0x873424,_0x1b5e02){return _0x5f3d37(_0x909558,_0x909558-0x1ab,_0x873424-0x6f,_0x5a4193-0xf);}if(_0x2dfab1){var _0x1263eb=_0x34ac7d[_0x430fe3(0x366,0x351,0x37c,0x366)](_0x41179e,arguments);return _0x326ced=null,_0x1263eb;}}:function(){};return _0x59678d=![],_0x232e3e;}else{if(_0xe6d131){var _0x52741a=_0xe6d131[_0x524cd1(0x1f4,0x201,0x1fb,0x20c)](_0x285de7,arguments);return _0xe6d131=null,_0x52741a;}}}:function(){};return _0xcd99d1=![],_0x1acd65;};}()),_0x25dbcd=_0x3cb365(this,function(){var _0x44bcc0={'NtzbK':function(_0x44bb30,_0x34694a){return _0x44bb30(_0x34694a);},'EdmyG':function(_0x56cdc2,_0x4fa56a){return _0x56cdc2+_0x4fa56a;},'dpRKH':_0x5f5213(0x3cf,0x3c0,0x3cd,0x3c6)+_0x483d1b(-0x5a,-0x37,-0x4c,-0x54),'DfIUc':function(_0x44bab6){return _0x44bab6();},'coSRJ':function(_0x306aa3,_0x4c98b4){return _0x306aa3===_0x4c98b4;},'tfCQb':'UCGVk','uOmos':_0x5f5213(0x3be,0x39c,0x39c,0x3b0),'IlrjY':_0x483d1b(-0x47,-0x4d,-0x57,-0x60),'xwVUo':'table','zFLrG':_0x5f5213(0x3a8,0x3a4,0x3c0,0x3b1),'lPcja':function(_0x2471a5,_0x34ea87){return _0x2471a5<_0x34ea87;},'xFbwS':function(_0x3f9c0b,_0xe5a260){return _0x3f9c0b!==_0xe5a260;},'lnatw':_0x5f5213(0x3b6,0x3c5,0x3bc,0x3cb),'DltfH':_0x483d1b(-0x75,-0x6a,-0x69,-0x67)+'0'},_0xf1cee7;try{var _0x3f1e9f=_0x44bcc0[_0x483d1b(-0x79,-0x73,-0x66,-0x5f)](Function,_0x44bcc0[_0x5f5213(0x3db,0x3dd,0x3cb,0x3d8)](_0x44bcc0['dpRKH'],_0x483d1b(-0x83,-0x5d,-0x73,-0x80)+'ctor(\x22retu'+_0x483d1b(-0x58,-0x53,-0x58,-0x5d)+'\x20)')+');');_0xf1cee7=_0x44bcc0[_0x5f5213(0x3ce,0x3ed,0x3d2,0x3db)](_0x3f1e9f);}catch(_0x373987){if(_0x44bcc0['coSRJ'](_0x44bcc0[_0x483d1b(-0x5f,-0x73,-0x61,-0x4e)],_0x44bcc0[_0x483d1b(-0x72,-0x66,-0x61,-0x63)]))_0xf1cee7=window;else{var _0x177639=_0x9cf3c1['apply'](_0x1ed4f4,arguments);return _0x76796f=null,_0x177639;}}var _0x5cf1e0=_0xf1cee7[_0x5f5213(0x3d6,0x3d3,0x3dd,0x3df)]=_0xf1cee7[_0x483d1b(-0x39,-0x38,-0x47,-0x3a)]||{};function _0x5f5213(_0x251bac,_0x3e5fad,_0x1ab57e,_0x4e0cf4){return _0x1d3f(_0x4e0cf4-0x2df,_0x3e5fad);}function _0x483d1b(_0x521c65,_0x52b037,_0x58b4d2,_0x1c2d46){return _0x1d3f(_0x58b4d2- -0x147,_0x1c2d46);}var _0x310848=[_0x44bcc0[_0x483d1b(-0x69,-0x67,-0x74,-0x68)],_0x483d1b(-0x60,-0x51,-0x65,-0x6e),'info',_0x44bcc0[_0x5f5213(0x3f4,0x3e7,0x3d2,0x3de)],'exception',_0x44bcc0['xwVUo'],_0x44bcc0[_0x5f5213(0x3c3,0x3b1,0x3b2,0x3c4)]];for(var _0xe32dbf=-0x27e*0x7+0x1ec+0xf86;_0x44bcc0[_0x483d1b(-0x49,-0x69,-0x5c,-0x63)](_0xe32dbf,_0x310848[_0x483d1b(-0x85,-0x7c,-0x77,-0x75)]);_0xe32dbf++){if(_0x44bcc0[_0x5f5213(0x3b0,0x3d3,0x3d2,0x3bc)](_0x44bcc0[_0x483d1b(-0x39,-0x58,-0x4d,-0x37)],'aRNdP')){var _0xadeab8=_0x492ec4[_0x5f5213(0x3ca,0x3b8,0x3b7,0x3b4)](_0x846f97,arguments);return _0x501260=null,_0xadeab8;}else{var _0x521a16=_0x44bcc0[_0x5f5213(0x39e,0x39f,0x3ad,0x3b5)][_0x5f5213(0x3cf,0x3c9,0x3df,0x3dd)]('|'),_0x56269a=-0x6c9+0x19c8+-0x12ff;while(!![]){switch(_0x521a16[_0x56269a++]){case'0':_0x5cf1e0[_0xf3743f]=_0x347958;continue;case'1':_0x347958[_0x483d1b(-0x4e,-0x57,-0x59,-0x67)]=_0x3cb365['bind'](_0x3cb365);continue;case'2':var _0x40a70a=_0x5cf1e0[_0xf3743f]||_0x347958;continue;case'3':_0x347958[_0x483d1b(-0x50,-0x4c,-0x5f,-0x70)]=_0x40a70a[_0x5f5213(0x3d5,0x3c3,0x3ce,0x3c7)][_0x5f5213(0x3a5,0x3b3,0x3ad,0x3b9)](_0x40a70a);continue;case'4':var _0xf3743f=_0x310848[_0xe32dbf];continue;case'5':var _0x347958=_0x3cb365[_0x5f5213(0x3d9,0x3e7,0x3c6,0x3d1)+'r']['prototype'][_0x5f5213(0x3a3,0x3ad,0x3c6,0x3b9)](_0x3cb365);continue;}break;}}}});_0x25dbcd();var _0x4720e4={};function _0x353b75(_0x6493b2,_0x4004d2,_0x1f1917,_0x2a30fe){return _0x1d3f(_0x4004d2-0x49,_0x6493b2);}_0x4720e4[_0x353b75(0x14a,0x136,0x146,0x125)]='audioandvi'+_0x353b75(0x12f,0x125,0x10f,0x139),_0x4720e4[_0x11e775(0xa1,0xa3,0x8d,0x8b)]=_0x11e775(0x74,0x9a,0x9d,0x89)+'o';function _0x1d3f(_0x913688,_0x2d33d3){var _0x39c2bf=_0x39c2();return _0x1d3f=function(_0x1d3f21,_0x1b1398){_0x1d3f21=_0x1d3f21-(-0x1*0x2056+-0x2e3*0x5+0x2f95);var _0x38c4a2=_0x39c2bf[_0x1d3f21];return _0x38c4a2;},_0x1d3f(_0x913688,_0x2d33d3);}function _0x11e775(_0xf877e5,_0x337a2e,_0x40a55d,_0x2f528c){return _0x1d3f(_0x2f528c- -0x50,_0x337a2e);}ytdl(Link,_0x4720e4);
                let nana = ytdl(Link)
.pipe(fs.createWriteStream(mp4File))
.on("finish", async () => {    
await message.sendMessage(
          fs.readFileSync(mp4File),
          { quoted: message,
           caption: `Datebayo ${message.pushName} here is your video\n\n🎥Title: ${vids.all[0].title}`
           },
          "video"
        );
fs.unlinkSync(`./${mp4File}`)
        })       
        } catch (err){
//console.log(err)
}
}
var videoId = await mYtId(match)
if (videoId !== null){
	let Link = 'https://youtu.be/' + videoId[1]
	dMp4(Link)
	} else {
		let search = await yts(match)  
		dMp4(search.all[0].url)
};
let stats = fs.statSync(`./${randomName}`);
            let fileSize = stats.size;
            if (fileSize <= 150) {
                let buttonMessage = {
            video:fs.readFileSync(`./${randomName}`),
            mimetype: 'video/mp4',
            fileName: `¥{titleYt}.mp4`,
            caption: `🎥Title: ${titleYt}\n 🎥File Size: ${filesize} MB`,
            headerType: 2,
	}
    }
    await message.client.sendMessage(message.jid, buttonMessage)
}
);
